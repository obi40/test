<md-content flex layout="column" class="sample-management-container">
    <form novalidate http-disable-click name="orderManagementForm" ng-submit="search()" flex layout="column">
        <div layout="row" layout-align="center center" flex layout-wrap>
            <md-input-container dynamic-flex="100|50|33|25|25">
                <label>{{'from' | translate}}</label>
                <md-datepicker date-mask name="visitDateFrom" ng-model="filters.visitDateFrom"
                    md-max-date="filters.visitDateTo?filters.visitDateTo:''"></md-datepicker>
                <input-messages input-errors=" orderManagementForm.visitDateFrom.$error" />
            </md-input-container>
            <md-input-container dynamic-flex="100|50|33|25|25">
                <label>{{'to' | translate}}</label>
                <md-datepicker date-mask name="visitDateTo" ng-model="filters.visitDateTo"
                    md-min-date="filters.visitDateFrom"></md-datepicker>
                <input-messages input-errors="orderManagementForm.visitDateTo.$error" />
            </md-input-container>
            <div flex></div>
            <md-button class="md-raised" type="button" ng-click="toggleAdvSearch()">
                {{'advancedSearch' | translate}}
            </md-button>
        </div>

        <div ng-hide="advancedSearch" flex layout="row" layout-wrap>
            <div flex="nogrow" class="md-padding">
                <md-radio-group ng-model="autoCompleteCriteria" layout="row" flex layout-wrap
                    ng-change="autoCompleteCriteriaListener()">
                    <md-radio-button ng-value="emrPatientInfoType">{{ 'patient' | translate }}</md-radio-button>
                    <md-radio-button ng-value="emrVisitType">{{ 'order' | translate }}</md-radio-button>
                    <md-radio-button ng-value="labSampleType">{{ 'sample' | translate }}</md-radio-button>
                    <md-radio-button ng-value="labTestActualType">{{ 'test' | translate }}</md-radio-button>
                </md-radio-group>
            </div>
            <autocomplete-search dynamic-flex="100|100|50|33|33" options="orderManagementSearchOptions">
            </autocomplete-search>
        </div>
        <div flex layout-wrap layout="row" ng-show="advancedSearch">
            <md-input-container dynamic-flex="100|100|25|20|20">
                <label>{{'orderNumber' | translate}}</label>
                <input name="admissionNumber" ng-model="filters.admissionNumber" />
                <input-messages input-errors="orderManagementForm.admissionNumber.$error" />
            </md-input-container>
            <md-input-container dynamic-flex="100|100|25|20|20">
                <label>{{'barcode' | translate}}</label>
                <input name="barcode" ng-model="filters.barcode" />
                <input-messages input-errors="orderManagementForm.barcode.$error" />
            </md-input-container>
            <md-input-container dynamic-flex="100|100|25|20|20">
                <label>{{'firstName' | translate}}</label>
                <input name="firstName" ng-model="filters.firstName" />
                <input-messages input-errors="orderManagementForm.firstName.$error" />
            </md-input-container>
            <md-input-container dynamic-flex="100|100|25|20|20">
                <label>{{'lastName' | translate}}</label>
                <input name="lastName" ng-model="filters.lastName" />
                <input-messages input-errors="orderManagementForm.lastName.$error" />
            </md-input-container>
            <md-input-container dynamic-flex="100|100|25|20|20">
                <label>{{'fileNumber' | translate}}</label>
                <input name="fileNo" ng-model="filters.fileNo" />
                <input-messages input-errors="orderManagementForm.fileNo.$error" />
            </md-input-container>
            <md-input-container dynamic-flex="100|100|25|20|20">
                <label>{{'mobileNumber' | translate}}</label>
                <input type="text" name="mobileNo" ng-model="filters.mobileNo" />
                <input-messages input-errors="orderManagementForm.mobileNo.$error" />
            </md-input-container>
            <md-input-container dynamic-flex="100|100|25|20|20">
                <label>{{'nationalNumber' | translate}}</label>
                <input type="number" name="nationalId" ng-model="filters.nationalId" ng-pattern="patternNum" />
                <input-messages input-errors="orderManagementForm.nationalId.$error" />
            </md-input-container>
            <md-input-container dynamic-flex="100|100|25|20|20">
                <label>{{'standardCode' | translate}}</label>
                <input name="standardCode" ng-model="filters.standardCode" />
                <input-messages input-errors="orderManagementForm.standardCode.$error" />
            </md-input-container>
            <md-input-container dynamic-flex="100|100|25|20|20">
                <label>{{'description' | translate}}</label>
                <input name="description" ng-model="filters.description" />
                <input-messages input-errors="orderManagementForm.description.$error" />
            </md-input-container>
            <md-input-container dynamic-flex="100|100|25|20|20">
                <label>{{'aliases' | translate}}</label>
                <input name="aliases" ng-model="filters.aliases" />
                <input-messages input-errors="orderManagementForm.aliases.$error" />
            </md-input-container>
            <md-input-container dynamic-flex="100|100|25|20|20">
                <label>{{'secondaryCode' | translate}}</label>
                <input name="secondaryCode" ng-model="filters.secondaryCode" />
                <input-messages input-errors="orderManagementForm.secondaryCode.$error" />
            </md-input-container>
            <lov dynamic-flex="100|100|25|20|20" form="orderManagementForm" options="visitTypeLkp"
                select="visitTypeLkp.selectedValue"></lov>
        </div>
        <div layout="row" layout-wrap layout-align="space-between center" dynamic-flex="100|100|33|25|25">
            <div dynamic-flex="100|100|25|25|25">
                <md-button class="md-primary md-raised" type="submit"
                    ng-disabled="orderManagementForm.$invalid || (filters.visitDateTo !== null && filters.visitDateFrom === null)">
                    <md-icon md-font-icon="fas fa-search"></md-icon>
                    <md-tooltip md-direction="top">{{'search' | translate}}</md-tooltip>
                </md-button>
                <md-button class="md-raised" type="button" ng-click="clearForm()">
                    <md-icon md-font-icon="fas fa-times"></md-icon>
                    <md-tooltip md-direction="top">{{'clear' | translate}}</md-tooltip>
                </md-button>
            </div>
            <div dynamic-flex="100|100|75|75|75" class="status-tree">
                <ul flex ng-class="{'cancelled-status':isCancelled==true || isClosed==true,
                                    'no-data':selectedObject == null}">
                    <li tabindex="0" flex class="status" ng-repeat="status in operationStatusList"
                        ng-class="status.style" ng-click="changeStatus(status)" authority-checker="{{status.authority}}"
                        ng-mouseleave="blurStatus($event)">
                        <md-icon md-font-icon="{{status.icon}}"></md-icon>
                        <md-tooltip class="bold status-tree-data-tooltip" md-direction="bottom"
                            ng-if="selectedObject!=null && status.data != null && status.code != 'PAID'">
                            <div flex layout="column" layout-align="center center">
                                <div flex layout-align="center start">
                                    <div flex>
                                        <md-icon md-font-icon="fas fa-user"></md-icon>
                                        {{status.data.operationByUser.fullName[userLocale]}}
                                    </div>
                                    <div flex>
                                        <md-icon md-font-icon="fas fa-calendar-alt"></md-icon>{{status.data.operationDate|
                                        dateTimeFormat}}
                                    </div>
                                </div>
                            </div>
                        </md-tooltip>
                        <md-tooltip class="bold status-tree-data-tooltip" md-direction="bottom"
                            ng-if="selectedObject!=null && status.data !=null && status.code == 'PAID' ">
                            <div flex layout="column" layout-align="center center">
                                <div flex layout-align="center start">
                                    <div flex>
                                        <md-icon md-font-icon="fas fa-dollar-sign"></md-icon>{{ ('totalAmount' |
                                        translate)+' = '+ (status.data.totalAmount | number:2) }}
                                    </div>
                                    <div flex>
                                        <md-icon md-font-icon="fas fa-dollar-sign"></md-icon>{{ ('remainingAmount' |
                                        translate)+' = '+ (status.data.remainingAmount| number:2) }}
                                    </div>
                                </div>
                            </div>
                        </md-tooltip>
                        <span class="status-name" flex>
                            {{status.name[userLocale]}}
                        </span>
                    </li>
                </ul>
            </div>
        </div>
    </form>
    <md-toolbar class="short-toolbar" flex>
        <div class="md-toolbar-tools">
            <div layout="row" flex layout-wrap>
                <md-button aria-label="{{isTreeGrid?'testView':'orderView' | translate}}" class="md-fab md-mini"
                    ng-click="toggleGrid()" type="button">
                    <md-tooltip md-direction="top">{{isTreeGrid?'testView':'orderView' | translate}}</md-tooltip>
                    <md-icon md-font-icon="fas fa-sitemap"></md-icon>
                </md-button>
                <md-button aria-label="{{ 'createOrder' | translate}}" class="md-fab md-mini" ng-click="createVisit()"
                    type="button" authority-checker="ADD_ORDER"
                    ng-disabled="selectedObject==null || selectedObject.emrPatientInfo.isActive == false">
                    <md-tooltip md-direction="top">{{'createOrder' | translate}}</md-tooltip>
                    <md-icon md-font-icon="fas fa-clipboard"></md-icon>
                </md-button>
                <md-button aria-label="{{ 'editOrder' | translate}}" class="md-fab md-mini" ng-click="editVisit()"
                    type="button" authority-checker="UPD_ORDER"
                    ng-disabled="selectedObject==null || selectedObject.type!=emrVisitType || selectedObject.emrPatientInfo.isActive == false || selectedObject.lkpOperationStatus.code == FINALIZED || selectedObject.lkpOperationStatus.code == CANCELLED || selectedObject.lkpOperationStatus.code == CLOSED">
                    <md-tooltip md-direction="top">{{'editOrder' | translate}}</md-tooltip>
                    <md-icon md-font-icon="fas fa-edit"></md-icon>
                </md-button>
                <md-button aria-label="{{ 'sampleSeparation' | translate}}" class="md-fab md-mini"
                    ng-click="viewSampleSeparation()" type="button"
                    ng-disabled="selectedObject==null || selectedObject.lkpOperationStatus.code === CANCELLED || selectedObject.lkpOperationStatus.code === REQUESTED">
                    <md-tooltip md-direction="top">{{'sampleSeparation' | translate}}</md-tooltip>
                    <md-icon md-font-icon="fa-lg lis-separation-factors"></md-icon>
                </md-button>
                <md-button aria-label="{{ 'barcode' | translate}}" class="md-fab md-mini" ng-click="printSample()"
                    type="button" ng-disabled="checkSampleStatus()">
                    <md-tooltip md-direction="top">{{'barcode' | translate}}</md-tooltip>
                    <md-icon md-font-icon="fas fa-barcode"></md-icon>
                </md-button>
                <md-button class="md-fab md-mini" aria-label="{{'worksheet' | translate}}" type="button"
                    ng-click="printWorksheet()" ng-disabled="checkSampleStatus()">
                    <md-icon md-font-icon="fas fa-clipboard-list"></md-icon>
                    <md-tooltip md-direction="top">{{'worksheet' | translate}}</md-tooltip>
                </md-button>
                <md-button aria-label="{{ 'printResults' | translate}}" class="md-fab md-mini"
                    ng-click="generateResultsReport()" type="button"
                    ng-disabled="selectedObject==null || (selectedObject.lkpOperationStatus.code !== RESULTS_ENTERED && selectedObject.lkpOperationStatus.code !== FINALIZED && selectedObject.lkpOperationStatus.code !== CLOSED)">
                    <md-tooltip md-direction="top">{{'printResults' | translate}}</md-tooltip>
                    <md-icon md-font-icon="fas fa-print"></md-icon>
                </md-button>
                <md-button aria-label="{{ 'amendResults' | translate}}" class="md-fab md-mini" type="button"
                    ng-click="amendResults()"
                    ng-disabled="selectedObject==null || (selectedObject.lkpOperationStatus.code !== FINALIZED && selectedObject.lkpOperationStatus.code !== CLOSED)">
                    <md-tooltip md-direction="top">{{'amendResults' | translate}}</md-tooltip>
                    <md-icon md-font-icon="fas fa-wrench"></md-icon>
                </md-button>
                <md-button aria-label="{{'printInvoice' | translate}}" class="md-fab md-mini"
                    ng-click="generateInvoiceReport()" type="button"
                    ng-disabled="selectedObject==null || selectedObject.type != emrVisitType">
                    <md-tooltip md-direction="top">{{'printInvoice' | translate}}</md-tooltip>
                    <md-icon md-font-icon="fas fa-print"></md-icon>
                </md-button>
                <md-button aria-label="{{'printInsuranceInvoice' | translate}}" class="md-fab md-mini"
                    ng-click="generateInsuranceInvoiceReport()" type="button"
                    ng-disabled="selectedObject==null || selectedObject.type != emrVisitType || selectedObject.providerPlan == null">
                    <md-tooltip md-direction="top">{{'printInsuranceInvoice' | translate}}</md-tooltip>
                    <md-icon md-font-icon="fas fa-print"></md-icon>
                </md-button>
                <md-button aria-label="{{ 'files' | translate}}" class="md-fab md-mini" ng-click="showArtifactDialog()"
                    type="button" ng-if="selectedObject.lkpOperationStatus.code === FINALIZED"
                    authority-checker="VIEW_ARTIFACT_FINALIZED"
                    ng-disabled="!selectedObject || selectedObject.type===labSampleType">
                    <md-tooltip md-direction="top">{{'files' | translate}}</md-tooltip>
                    <md-icon md-font-icon="fas fa-file"></md-icon>
                </md-button>
                <md-button aria-label="{{ 'files' | translate}}" class="md-fab md-mini" ng-click="showArtifactDialog()"
                    type="button" ng-if="selectedObject.lkpOperationStatus.code !== FINALIZED"
                    authority-checker="VIEW_ARTIFACT"
                    ng-disabled="!selectedObject || selectedObject.type===labSampleType">
                    <md-tooltip md-direction="top">{{'files' | translate}}</md-tooltip>
                    <md-icon md-font-icon="fas fa-file"></md-icon>
                </md-button>
                <md-button aria-label="{{ 'refund' | translate}}" class="md-fab md-mini" ng-click="refundVisit()"
                    type="button" authority-checker="REFUND_PAYMENT"
                    ng-disabled="selectedObject==null || selectedObject.paidAmount <= 0">
                    <md-tooltip md-direction="top">{{'refund' | translate}}</md-tooltip>
                    <md-icon md-font-icon="fas fa-hand-holding-usd"></md-icon>
                </md-button>
            </div>
            <div layout="row">
                <md-button aria-label="{{ 'refresh' | translate}}" class="md-fab md-mini" http-disable-click
                    ng-click="refreshGrids()" type="button">
                    <md-tooltip md-direction="top">{{'refresh' | translate}}</md-tooltip>
                    <md-icon md-font-icon="fas fa-sync"></md-icon>
                </md-button>
            </div>
        </div>
    </md-toolbar>
    <div ng-show="isTreeGrid" kendo-tree-list="orderManagementTreeGrid" id="orderManagementTreeGrid"
        class="k-widget k-tree-list" options="orderManagementTreeGridOptions"></div>
    <div ng-show="isTreeGrid" id="pager"></div>
    <div ng-show="!isTreeGrid" kendo-grid="orderManagementGrid" id="orderManagementGrid" class="k-widget k-grid"
        options="orderManagementGridOptions"></div>
</md-content>